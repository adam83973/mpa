<h3>Lead Management</h3>
<div id="lead_stages">
  <ul class="nav nav-pills">
    <li class="dropdown">
      <a class="dropdown-toggle"
         data-toggle="dropdown"
         href="#">
          Lead Stages
          <b class="caret"></b>
        </a>
      <ul class="dropdown-menu">
        <li><%= link_to "New Leads", "javascript:void(0)", data: { stageid: 6 } %></li>
        <li><%= link_to "Appointment Scheduled", "javascript:void(0)", data: { stageid: 1 } %></li>
        <li><%= link_to "Appointment Missed", "javascript:void(0)", data: { stageid: 7 } %></li>
        <li><%= link_to "Assesment Completed", "javascript:void(0)", data: { stageid: 2 } %></li>
        <li><%= link_to "Trial Offered", "javascript:void(0)", data: { stageid: 3 } %></li>
        <li><%= link_to "Won", "javascript:void(0)", data: { stageid: 4 } %></li>
        <li><%= link_to "Lost", "javascript:void(0)", data: { stageid: 5 } %></li>
      </ul>
    </li>
  </ul>
</div>
<div class="row">
  <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
    <div id="stage_list">
      <div class="well well-lg">
        <h4><u>New</u></h4>
        <ul>
          <% current_user.location.leads.includes(:stage).where("stage_id = ?", 6).each do |lead| %>

            <div class="lead_group">
              <div id="lead<%= lead.id %>" data-id="<%= lead.id %>" class="well well-sm" style="z-index:1;">
                <li>
                  <div class="row">
                    <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10">
                      <%= link_to "#{lead.full_name}", lead%> - Stage: <%= lead.stage.name %>
                    </div> <!-- /span9 -->
                    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
                      <%= link_to "javascript:void(0)", class: "stage_attr" do %>
                        <i class="fa fa-plus pull-right"></i>
                      <% end %>
                    </div>
                  </div> <!-- /.row -->
                </li>
              </div> <!-- /.ui-draggable -->
              <div class="lead_toolbar" style="display:none;">
                  <%= simple_form_for [Lead.find(lead.id), Note.new], remote: true do |f| %>
                    <%= f.input :content, input_html: { rows: 4, style: "width:100%;" } %>
                    <%= f.input :user_id, as: :hidden, input_html: { value: current_user.id } %>
                    <%= f.input :lead_id, as: :hidden, input_html: { value: lead.id } %>
                    <%= f.button :submit, class: "btn btn-success btn-xs" %>
                  <% end %>
              </div> <!-- /.lead_toolbar -->
            </div> <!-- /.lead_group -->
          <% end %>
        </ul></br>
          <p><%= link_to "Add Lead", "#leadModal", data: {toggle: :modal} %></p>
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
    <div id="stage_droppable">
      <div class="leads well well-sm text-center" id="appointment_scheduled">
        <h4><u>Appointment Scheduled: <span><%= Lead.active_stage_count("Appointment Scheduled", current_user.location_id)%></span></u></h4>
        <p></p>
      </div><!-- /.leads -->
      <div class="leads well well-sm text-center" id="appointment_missed">
        <h4><u>Appointment Missed: <span><%= Lead.active_stage_count("Appointment Missed", current_user.location_id)%></span></u></h4>
        <p></p>
      </div><!-- /.leads -->
      <div class="leads well well-sm text-center" id="assessment_completed">
        <h4><u>Assessment Completed: <span><%= Lead.active_stage_count("Assessment Completed", current_user.location_id)%></span></u></h4>
        <p></p>
      </div><!-- /.leads -->
      <div class="leads well well-sm text-center" id="trial_offered">
        <h4><u>Trial Offered: <span><%= Lead.active_stage_count("Trial Offered", current_user.location_id)%></span></u></h4>
        <p></p>
      </div><!-- /.leads -->
      <div class="leads well well-sm text-center" id="won">
        <h4><u>Won</u></h4>
        <p></p>
      </div><!-- /.leads -->
      <div class="leads well well-sm text-center" id="lost">
        <h4><u>Lost</u></h4>
        <p></p>
      </div><!-- /.leads -->
    </div><!-- /#stage_droppable -->
  </div><!-- /.span4 -->
</div><!-- /.row -->

<%= render 'lead_modal' %>