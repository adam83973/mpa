<h3>Subscriptions & Invoices for <%= @subscriber["FirstName"] %> <%= @subscriber["LastName"] %></h3>
<div class="row">
	<div class="span8">
		<h4>Subscriptions</h4>
		<table class="table table-striped table-bordered table-condensed">
			<thead>
				<tr>
					<th>Description</th>
					<th>Start</th>
					<th>Next Bill</th>
					<th>End</th>
					<th>Price</th>
					<th>Qty</th>
					<th>Auto?</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				<% @active_subscription.each do |i| %>
				<% if i["Status"] == "Inactive" %>
					<tr class="warning">
				<% else %>
					<tr class="success">
				<% end %>
						<td><%= i["ProgramName"] %></td>
						<td><%= i["StartDate"].to_date().strftime("%b-%d-%y") %></td>
						<td><%= i["NextBillDate"].to_date().strftime("%b-%d-%y") %></td>
						<td><%= i["EndDate"] == nil ? "None" : i["EndDate"].to_date().strftime("%b-%d-%y") %></td>
						<td><%= number_to_currency(i["BillingAmt"]) %></td>
						<td><%= i["Qty"] %></td>
						<td><%= i["AutoCharge"] == 1 ? "Y" : "N" %></td>
						<% if i["Status"] == "Inactive" %>
							<td></td>
						<% else %>
							<td><%= link_to 'End', infusion_pages_end_subscription_path(i.merge(ContactId: params[:ContactId])), class: 'btn btn-small btn-danger' %></td>
						<% end %>
					</tr>
				<% end %>
			</tbody>
		</table>
		<h4>Recent Invoices</h4>
		<table class="table table-striped table-bordered table-condensed">
			<thead>
				<tr>
					<th>Date</th>
					<th>Description</th>
					<th>Total</th>
					<th>Balance</th>
					<th>Status</th>
				</tr>
			</thead>
			<tbody>
				<% @invoices.each do |i| %>
				<tr>
					<td><%= i["DateCreated"].to_date().strftime("%b-%d-%y") %></td>
					<td><%= i["Description"] %></td>
					<td><%= number_to_currency(i["InvoiceTotal"]) %></td>
					<td><%= number_to_currency(i["InvoiceTotal"] - i["TotalPaid"]) %></td>
					<td><%= i["Status"].html_safe %></td>
				</tr>
				<% end %>
			</tbody>
		</table>
	</div>
	<div class="span4">
		<div class="well">
			<h4>Add a Subscription</h4>
			<%= form_tag url_for(controller: 'infusion_pages', action: 'update_subscription'), {:method => :get, class: 'form-horizontal'} do %>
				<%= hidden_field_tag :ContactId, params[:ContactId] %>
				<%= select_tag :cProgramId, options_for_select(@dropdown, @subscription),{:onchange => 'this.form.submit()'} %>
			<% end %>
			<%= form_tag url_for(controller: 'infusion_pages', action: 'add_subscription'), {:method => :get, class: 'form-horizontal'} do %>
				<%= hidden_field_tag :ContactId, params[:ContactId] %>
				<%= hidden_field_tag :cProgramId, params[:cProgramId] %>
				<%= hidden_field_tag :merchantAccountId, 5 %>
			 	<label>Qty </label>
				<%= text_field_tag :qty, 1, class: 'input-small' %>
				<label>Price </label>
				<div class="input-prepend input-append">
					<span class="add-on">$</span>
					<%= text_field_tag :price, @price, class: 'input-small' %>
					<span class="add-on">.00</span>
				</div>
				<label>First Bill Date </label>
				<%= select_date Date.today, prefix: :startBillDate, class: 'input-small' %>
			 	<label>Deposit </label>
				<div class="input-prepend input-append">
					<span class="add-on">$</span>
					<%= text_field_tag :deposit, 0, class: 'input-small' %>
					<span class="add-on">.00</span>
				</div>
				<label>Credit Card </label>
				<%= select_tag :creditCardId, options_for_select(@credit_card_options) %>
				<hr>
				<%= submit_tag "Add Subscription", :name => nil, class: 'btn btn-success btn-small' %>
				<%= link_to 'New Credit Card', infusion_pages_edit_path(params.merge(id: params[:ContactId])), class: 'btn  btn-small' %>
			<% end %>
		</div>
	</div>
</div>
<%= link_to 'Search', infusion_pages_home_path(), class: 'btn btn-small' %>
<%= link_to 'Edit', infusion_pages_edit_path(ContactId: params[:ContactId]), class: 'btn btn-small' %>
