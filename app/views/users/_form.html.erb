<% if params[:infusion_id] %>
<div class="row-fluid">
  <div class="span4">
  <%= simple_form_for @user, validate: true do |f| %>
  <% if @user.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:</h2>

      <ul>
      <% @user.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
    <%= f.input :role, collection: ["Admin", "Teacher", "Teaching Assistant", "Parent", "Robotics Instructor", "Programming Instructor", "Chess Instructor"] if current_user.employee? %>
    <% if params[:first_name] %>
      <%= f.input :first_name, label: "First Name", input_html: { value: params[:first_name]} %>
      <%= f.input :last_name, label: "Last Name", input_html: { value: params[:last_name]} %>
      <%= f.input :phone, input_html: { value: params[:phone]} %>
      <%= f.input :email, input_html: { value: params[:email]} %>
    <% else %>
      <%= f.input :first_name, label: "First Name" %>
      <%= f.input :last_name, label: "Last Name" %>
      <%= f.input :phone %>
      <%= f.input :email %>
    <% end %>
  </div>
  <div class="span4">
    <% if current_user.employee? %>
      <%= f.input :infusion_id, label: 'Infusionsoft Id', hint: 'Only for Parents', input_html: { class: "warning", value: params[:infusion_id]}  %>
      <%= f.input :passion %>
      <%= f.input :shirt_size %>
      <%= f.association :location, label_method: :name %>
      <%= f.input :has_key %>
      <%= f.input :admin if current_user.admin? %>
      <%= f.input :active if current_user.admin? %>
    <% end %>
  </div>
  <div class="span4">
    <%= f.input :password %>
    <%= f.input :password_confirmation %>
  </div>
</div>
    <%= f.button :submit, class: "m-btn" %>
  <% end %>
<% else %>
<div class="row-fluid">
  <div class="span4">
  <%= simple_form_for @user, :validate => true do |f| %>
    <% if @user.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:</h2>

        <ul>
        <% @user.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
        </ul>
      </div>
    <% end %>
      <%= f.input :role, collection: ["Admin", "Teacher", "Teaching Assistant", "Parent", "Robotics Instructor", "Programming Instructor", "Chess Instructor"] if current_user.employee? %>
      <%= f.input :first_name, label: "First Name" %>
      <%= f.input :last_name, label: "Last Name" %>
      <%= f.input :phone %>
      <%= f.input :email %>
      <% if  @contacts || (@user.role == "Parent" && @user.infusion_id == nil) %>
        <%= f.input :infusion_id, label: 'Infusionsoft Id', hint: 'Only for Parents', input_html: { style: "background:yellow;" } if current_user.employee? %>
      <% else %>
        <%= f.input :infusion_id, label: 'Infusionsoft Id', hint: 'Only for Parents' if current_user.employee? %>
      <% end %>
  </div>
  <div class="span4">
    <% if current_user.employee? %>
      <%= f.input :passion %>
      <%= f.input :shirt_size %>
      <%= f.association :location, label_method: :name %>
      <%= f.input :has_key %>
      <%= f.input :admin if current_user.admin? %>
    <% end %>
  </div>
  <div class="span4">
    <%= f.input :password %>
    <%= f.input :password_confirmation %>
    <%= f.input :active if current_user.admin? %>
  </div>
</div>
<%= f.button :submit, class: "m-btn green pull-right" %>
<% end %>
<% end %>
