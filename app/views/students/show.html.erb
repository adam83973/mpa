<% title @student.full_name %>
<% if @student.has_learning_plan && current_user.employee? %>
  <div class="lp_icon">
    <%= link_to @student.learning_plans.last do %>
      <%= image_tag "lp_icon.svg", size: "100" %>
    <% end %>
  </div>
<% end %>
<% if current_user.employee? %>
  <%= link_to "Edit Student", edit_student_path(@student), class: "btn btn-default pull-right", style: "margin-bottom:15px;" %>
  <% unless @student.has_learning_plan %>
    <%= link_to "Add Learning Plan", new_learning_plan_path(student_id: @student.id), class: "btn btn-default pull-right", style: "margin-right:10px;" %>
  <% end %>
<% end %>
<div class="row">
  <%= render 'student_stats' %>
</div>

<div class="row paddingtop15">
  <div class="col-lg-3 col-md-3 col-xs-12 col-sm-12 class_list">
    <%= render 'student_class_list' %>
  </div>

  <div class="col-lg-9 col-md-9 col-xs-12 col-sm-12 achievements">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <%= render 'student_toolbar' %>
      </div>
    </div>
    <% unless current_user.employee? %>
      <hr style="margin:0 0 10px 0;">
    <% end %>
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <h3>Badges Earned!</h3>
        <% @earned_badges_with_count.each do |badge, count| %>
        <div title="<%= badge.name %>" class='badge-count' <%= "data-badge=#{count}" if count > 1 %>>
          <%= link_to badge do %>
            <%= image_tag(badge.image_url, size: '100x100') %>
          <% end %>
        </div>
        <% end%>
        <div class='badge-link pull-right'>
          <%= link_to badges_student_path, style: 'display:inline-block;vertical-align:middle;' do %>
            <h4 style='padding-left:5px;'><%= @student.first_name %>'s<br>Badges</h4>
          <% end %>
        </div>
      </div>
    </div>
    <hr style="margin-bottom:0;">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <%= render 'student_achievements' %>
      </div>
    </div>
    <hr style="margin-bottom:0;">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <h3>Assignments</h3>
        <div class="panel-group" id="accordion-assignments">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion-assignments" href="#collapse-assignments">
                  Assignments
                </a>
              </h4>
            </div>
            <div id="collapse-assignments" class="panel-collapse collapse">
              <div class="panel-body">
                <div class="tscroll a-achievements">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th>Class</th>
                        <th>Week</th>
                        <th>Score</th>
                        <th>Corrected</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                      <% @student.assignments.includes(offering: [ :course, :location ]).order(course_id: :desc, week: :desc).limit(100).each do |assignment| %>
                      <tr>
                        <td><%= assignment.course.course_name if assignment.course %></td>
                        <td><%= assignment.week %></td>
                        <td><%= Assignment::SCORES[assignment.score] %></td>
                        <td><%= assignment.score == 2 ? "N/A" : assignment.corrected %></td>
                        <%if ["Teacher", "Teaching Assistant", "Director", "Admin"].include?(current_user.role) %>
                        <td>
                          <%= link_to "Add Correction", edit_assignment_path(assignment) if !assignment.corrected && assignment.score != 2 %>
                        </td>
                        <% else %>
                        <td></td>
                        <% end %>
                      </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <%= render 'student_comment_feed'%>
      </div>
    </div>
  </div>
</div>
<% unless current_user.parent? %>
  <hr>
<% end %>

<% if current_user.employee? %>
  <div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
      <h2 style="margin-bottom:40px;"><u>Student Account Administration</u></h2>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 style="display:inline;" class="panel-title">Notes</h3>
        </div>
        <div class="panel-body" style="padding-bottom:0;">
          <!-- displays note form and notes for student -->
          <%= render 'student_notes' %>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 style="display:inline;" class="panel-title">Registration History</h3>
        </div>
        <div class="panel-body"
        style="padding:20px 15px 0 15px;max-height:100px;overflow:scroll;">
          <!-- displays note form and notes for student -->
          <% @registrations.each_with_index do |registration, i| %>
            <% if i % 3 == 0 %>
              <div class="row">
            <% end %>
            <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
              <%= render 'student_registration_card', reg: registration, student: @student, editable: false %>
            </div>
            <% if (i+1) % 3 == 0 || @registrations.count == i+1 %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

  </div>
<% end %>



<!-- modal stuff below -->

<%= render '/static_pages/grades_modal' %>

<%= render 'credits_modal' %>

<%= render 'occupation_modals' %>

<%= render 'registration_switch_modal' %>

<%= render 'registration_drop_modal' %>

<%= render 'registration_hold_modal' %>

<%= render 'add_to_class_modal' %>

<%= render 'add_avatar_modal', student: @student if current_user.employee? || current_user == @student.user %>
